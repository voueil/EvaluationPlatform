<!doctype html> 
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Project Evaluation</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <link rel="stylesheet" href="styles.css">
  <style>
    .back-btn {
      position: fixed;
      top: 20px;
      left: 20px;
      background: #c6b2eb; 
      color: #fff;
      padding: 12px 22px;
      border-radius: 16px;
      border: none;
      font-size: 18px;
      font-weight: 600;
      cursor: pointer;
      transition: 0.2s;
      z-index: 1000;
      box-shadow: 0 3px 10px rgba(0,0,0,0.1);
    }
    .instructions { direction: ltr; text-align: left; }
    .instructions ul, .instructions ol { padding-left: 20px; }
    .field label, [data-key] { direction: ltr; text-align: left; }
    #projTitle, #projDesc, #studentsNames { text-align: center !important; }
  </style>
</head>
<body>
  <button class="back-btn" onclick="history.back()">Back</button>

  <header class="header"><h1>Project Evaluation</h1></header>

  <main class="container">
    <div class="card">
      <h3 id="projTitle"></h3>
      <p id="studentsNames" class="small"></p>
      <p id="projDesc" class="small"></p>

      <div class="card instructions" style="background:#f9f7fd; border:none; padding:10px; margin-bottom:18px;">
        <strong>Instructions for Evaluators:</strong>
        <ol>
          <li>Select a score for each criterion</li>
          <li>The system will automatically calculate the total score</li>
          <li>Score explanation:</li>
          <ul>
            <li>10 — Excellent</li>
            <li>8 — Very Good</li>
            <li>6 — Good</li>
            <li>4 — Fair</li>
            <li>2 — Poor</li>
            <li>0 — 0</li>
            </ul>
        </ol>
      </div>

      <form id="form">
        <div id="criteriaList"></div>
        <button class="button" type="submit">Submit Evaluation</button>
      </form>
    </div>
  </main>

  <script src="app.js"></script>
  <script>
    const params = new URLSearchParams(location.search);
    const id = params.get("project");
    const evaluator = params.get("evaluator"); 
    const project = APP.INITIAL_PROJECTS[id];
    if (!project || !evaluator) { alert("Project or evaluator not found"); location = "login.html"; }

    document.getElementById("projTitle").textContent = project.name;
    document.getElementById("projDesc").textContent = project.description;
    document.getElementById("studentsNames").textContent = project.students || '';

    const container = document.getElementById("criteriaList");
    const ratingOptions = `
      <option value="10">10</option>
      <option value="8">8</option>
      <option value="6">6</option>
      <option value="4">4</option>
      <option value="2">2</option>
      <option value="0">0</option>
    `;

    APP.CRITERIA.forEach(c => {
      const div = document.createElement("div");
      div.className = "field";
      div.innerHTML = `<label>${c.label}</label>
                       <select data-key="${c.key}">${ratingOptions}</select>`;
      container.appendChild(div);
    });

    document.getElementById("form").addEventListener("submit", e => {
      e.preventDefault();

      const existing = APP.loadRatings(id).find(r => r.evaluatorName === evaluator);
      if (existing) { alert("You have already evaluated this project"); return; }

      const scores = {};
      document.querySelectorAll("[data-key]").forEach(sel => {
        scores[sel.dataset.key] = Number(sel.value);
      });

      APP.addRating(id, evaluator, scores);
      alert("✅ Evaluation saved successfully");
      location.href = `index.html`;
    });
  </script>
</body>
</html>
